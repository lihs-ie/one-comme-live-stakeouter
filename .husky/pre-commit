#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ã‚³ãƒŸãƒƒãƒˆå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å–å¾—ï¼ˆè¨­å®šç³»jsãƒ•ã‚¡ã‚¤ãƒ«ã¯é™¤å¤–ï¼‰
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM \
	| grep -E '\.(ts|tsx|js|jsx)$' \
	| grep -vE '(^|/)\.eslintrc\.js$|(^|/)webpack(\.[^/]+)?\.config\.js$' \
	| tr '\n' ' ')

# TypeScriptå‹ãƒã‚§ãƒƒã‚¯ï¼ˆå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰
if [ -n "$STAGED_FILES" ]; then
	echo "ğŸ” Running TypeScript type check on staged files..."
	pnpm exec tsc --noEmit $STAGED_FILES
else
	echo "No staged TypeScript/JavaScript files to type-check."
fi

# lint-stagedå®Ÿè¡Œï¼ˆlint-stagedè‡ªä½“ãŒå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å‡¦ç†ï¼‰
echo "ğŸ¨ Running lint-staged..."
pnpm exec lint-staged

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢é€£ã™ã‚‹ã‚‚ã®ã®ã¿ï¼‰
if [ -n "$STAGED_FILES" ]; then
	echo "ğŸ§ª Running related tests for staged files..."
	pnpm exec vitest related --run $STAGED_FILES
else
	echo "No staged files to test."
fi

echo "âœ… Pre-commit checks completed!"
